<div class="search-container">
  <form (submit)="onSearch()">
    <div class="Search-bar">
      <div class="input-box">
        <input
          type="text"
          name="searchQuery"
          id="searchQuery"
          placeholder="איזור, עיר שכונה או רחוב"
          class="input-search"
          #searchInputLocation
          autocomplete="off"
          (focus)="
            this.searchSuggestionsIsOpen =
              searchInputLocation.value.length === 0 ? true : false;
            this.searchSuggestionsIsOpen = true
          "
          (blur)="this.searchSuggestionsIsOpen = false"
          (input)="
            this.historyLocationSearchIsOpen =
              searchInputLocation.value.length > 0 ? false : true;
            searchInputLocation.focus()
          "
          (keydown)="this.displayHistory(searchInputLocation.value.length)"
        />
        @if(this.searchSuggestionsIsOpen ){
        <div class="search-suggestions">
          <!-- Static suggestion, always present -->
          <div
            id="locationSuggestion"
            class="search-suggestion"
            [ngStyle]="{ height: '54px', color: '#ff7100' }"
          >
            <img
              class="location-arrow-img"
              src="assets/images/location-arrow.svg"
              alt=""
            />
            <span> קרוב אליי </span>
          </div>

          <!-- Dynamic suggestions from array -->
          @if(this.historyLocationSearchIsOpen){
          <div class="title-locationSuggestion">חיפושים אחרונים</div>

          <div
            *ngFor="
              let suggestion of historyLocationSearchSuggestions;
              let index = index
            "
            class="search-suggestion"
            [ngStyle]="{
              height: '48px',
              'border-bottom-left-radius':
                this.historyLocationSearchSuggestions.length == index + 1
                  ? '12px'
                  : '0px',
              'border-bottom-right-radius':
                this.historyLocationSearchSuggestions.length == index + 1
                  ? '12px'
                  : '0px'
            }"
            (mouseenter)="this.lastHoverSearchHistory = index"
            [ngClass]="
              this.lastHoverSearchHistory === index
                ? 'gray-color search-suggestion'
                : 'search-suggestion'
            "
          >
            <img
              class="history-img"
              src="assets/images/history-svgrepo-com.svg"
              alt=""
            />
            <span class="suggestion-location"> {{ suggestion }}</span>
          </div>
          } @else if( searchInputLocation.value.length > 1) { @if(true){
          <div style="height: 34.9px" class="title-locationSuggestions">
            שכונה
          </div>
          } @if(true){
          <div style="height: 34.9px" class="title-locationSuggestions">
            עיר
          </div>
          @if(true){
          <div style="height: 34.9px" class="title-locationSuggestions">
            אזור
          </div>
          } @if(true){
          <div style="height: 34.9px" class="title-locationSuggestions">
            רחוב
          </div>
          @if( searchInputLocation.value.length > 1){
          <div
            id="street-option"
            class="title-locationSuggestions"
            *ngFor="
              let item of this.getStreetSuggestions(
                searchInputLocation.value
              ).slice(0, 3);
              let i = index
            "
            style="height: 42.3906px"
          >
            <span> {{ item.Street_Name }}</span>
            <span class="comma"> ,</span><br />
            <span>{{ item.City_Name }}</span>
          </div>

          } } } }
        </div>
        }
      </div>

      <div class="menu-container" #tradeTypeMenu>
        <button
          class="search-button"
          type="button"
          (click)="toggleMenu('tradeTypeMenu')"
        >
          {{ advertisementTypebuttonText }}
          <i id="tradeTypeArrow" class="material-icons">keyboard_arrow_down</i>
        </button>
        <div id="tradeTypeMenu" class="menu hidden dropdown-menu">
          <button class="type-btn" type="button" (click)="applyFilter('מכירה')">
            מכירה
          </button>
          <button class="type-btn" type="button" (click)="applyFilter('השכרה')">
            השכרה
          </button>
        </div>
      </div>

      <div class="menu-container" #propertyTypeMenu>
        <button
          class="search-button"
          type="button"
          (click)="toggleMenu('propertyTypeMenu')"
        >
          סוג הנכס

          <i id="propertyTypeArrow" class="material-icons"
            >keyboard_arrow_down</i
          >
        </button>
        <div id="propertyTypeMenu" class="menu hidden">
          <app-real-estate-property-type
            (propertyTypeSelected)="onPropertyTypeSelected($event)"
          ></app-real-estate-property-type>
        </div>
      </div>
      <div class="menu-container" #priceSlider>
        <button
          #priceSliderButton
          (click)="toggleMenu('priceSlider')"
          class="search-button price-btn"
          type="button"
        >
          מחיר
          <i id="PriceRangeArrow" class="material-icons">keyboard_arrow_down</i>
        </button>
        <div id="PriceRangeMenu" class="menu hidden">
          <app-real-estate-price-slider
            (selectedPriceRange)="onPriceRangeSelected($event)"
          ></app-real-estate-price-slider>
        </div>
      </div>

      <div class="menu-container" #roomsAmountMenu>
        <button
          id="propertyRoomButton"
          (click)="
            toggleMenu('roomsAmountMenu');
            this.roomsFilterIsOpen = !this.roomsFilterIsOpen
          "
          class="search-button"
          type="button"
        >
          חדרים

          <i
            id="propertyRoomArrow"
            class="material-icons"
            [ngStyle]="{
              transform: roomsFilterIsOpen ? 'rotate(180deg)' : 'rotate(0deg)'
            }"
            >keyboard_arrow_down</i
          >
        </button>
        <div id="propertyRoomMenu" class="menu hidden">
          <app-real-estate-rooms-amount
            id="roomsAmountFilter"
            (propertyRoomSelected)="onRoomsAmountSelected($event)"
          ></app-real-estate-rooms-amount>
        </div>
      </div>

      <div class="menu-container" #additionalFiltersMenu>
        <button
          (click)="toggleMenu('additionalFiltersMenu')"
          class="search-button"
          type="button"
        >
          <i id="additionalFiltersArrow" class="material-icons">tune</i>
          <div class="space"></div>

          סינונים נוספים
        </button>
        <div id="additionalFiltersMenu" class="menu hidden">
          <app-real-estate-additional-filters
            (closeMenu)="onCloseAdditionalFiltersMenu(undefined)"
          ></app-real-estate-additional-filters>
        </div>
      </div>

      <button class="search-button-orange" type="submit">חיפוש</button>
      <button class="search-button alert-btn" type="button">
        <div class="">
          <img class="bell-img" src="assets/images/bell.svg" alt="" />
        </div>
        <div>יצירת התראה</div>
      </button>
    </div>
  </form>
</div>
<h1 class="title">{{ title }}</h1>

<div class="project-container">
  <div class="project-div">
    <i class="material-icons">keyboard_arrow_left</i>לכל הפרויקטים
  </div>
  <div class="project-div">
    פרויקטים חדשים
    <img class="logo-img" src="assets/images/logo-yad-blue.svg" alt="" />
  </div>
</div>
<div class="adds">
  <div class="ad" *ngFor="let ad of searchService.adds">
    <img [src]="ad.pic" alt="" />
    <div class="content">
      <div class="ad-title">{{ ad.title }}</div>
      <div class="ad-city">{{ ad.city }}</div>
      <div class="ad-project">{{ ad.program }}</div>
    </div>
  </div>
</div>

<app-real-estate-results></app-real-estate-results>
